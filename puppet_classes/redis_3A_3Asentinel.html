<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: redis::sentinel
  
    &mdash; Documentation by YARD 0.9.9
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::redis::sentinel";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (r)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">redis::sentinel</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: redis::sentinel</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd><span class='object_link'><a href="redis_3A_3Aparams.html" title="puppet_classes::redis::params (puppet_class)">redis::params</a></span></dd>
  </dl>
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/sentinel.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>= Class: redis::sentinel</p>

<p>This class installs redis-sentinel</p>

<p>== Parameters:</p>

<p>[<em>auth_pass</em>]  The password to use to authenticate with the master
and slaves.</p>

<p>Default: undef</p>

<p>[<em>config_file</em>]  The location and name of the sentinel config file.</p>

<p>Default for deb: /etc/redis/redis-sentinel.conf  Default for rpm:
/etc/redis-sentinel.conf</p>

<p>[<em>config_file_orig</em>]  The location and name of a config file that
provides the source  of the sentinel config file. Two different files are
needed  because sentinel itself writes to its own config file and we do 
not want override that when puppet is run unless there are  changes from
the manifests.</p>

<p>Default for deb: /etc/redis/redis-sentinel.conf.puppet  Default for rpm:
/etc/redis-sentinel.conf.puppet</p>

<p>[<em>config_file_mode</em>]  Permissions of config file.</p>

<p>Default: 0644</p>

<p>[<em>conf_template</em>]  Define which template to use.</p>

<p>Default: redis/redis-sentinel.conf.erb</p>

<p>[<em>daemonize</em>]  Have Redis sentinel run as a daemon.</p>

<p>Default: true</p>

<p>[<em>down_after</em>]  Number of milliseconds the master (or any attached
slave or sentinel)  should be unreachable (as in, not acceptable reply to
PING, continuously,  for the specified period) in order to consider it in
S_DOWN state.</p>

<p>Default: 30000</p>

<p>[<em>failover_timeout</em>]  Specify the failover timeout in milliseconds.</p>

<p>Default: 180000</p>

<p>[<em>init_script</em>]  Specifiy the init script that will be created for
sentinel.</p>

<p>Default: undef on rpm, /etc/init.d/redis-sentinel on apt.</p>

<p>[<em>log_file</em>]  Specify where to write log entries.</p>

<p>Default: /var/log/redis/redis.log</p>

<p>[<em>master_name</em>]  Specify the name of the master redis server.  The
valid charset is A-z 0-9 and the three characters “.-_”.</p>

<p>Default: mymaster</p>

<p>[<em>redis_host</em>]  Specify the bound host of the master redis server.</p>

<p>Default: 127.0.0.1</p>

<p>[<em>redis_port</em>]  Specify the port of the master redis server.</p>

<p>Default: 6379</p>

<p>[<em>package_name</em>]  The name of the package that installs sentinel.</p>

<p>Default: &#39;redis-server&#39; on apt, &#39;redis&#39; on rpm</p>

<p>[<em>package_ensure</em>]  Do we ensure this package.</p>

<p>Default: &#39;present&#39;</p>

<p>[<em>parallel_sync</em>]  How many slaves can be reconfigured at the same
time to use a  new master after a failover.</p>

<p>Default: 1</p>

<p>[<em>pid_file</em>]  If sentinel is daemonized it will write its pid at
this location.</p>

<p>Default: /var/run/redis/redis-sentinel.pid</p>

<p>[<em>quorum</em>]  Number of sentinels that must agree that a master is
down to  signal sdown state.</p>

<p>Default: 2</p>

<p>[<em>sentinel_bind</em>]  Allow optional sentinel server ip binding. Can
help overcome  issues arising from protect-mode added Redis 3.2</p>

<p>Default: undef</p>

<p>[<em>sentinel_port</em>]  The port of sentinel server.</p>

<p>Default: 26379</p>

<p>[<em>service_group</em>]  The group of the config file.</p>

<p>Default: redis</p>

<p>[<em>service_name</em>]  The name of the service (for puppet to manage).</p>

<p>Default: redis-sentinel</p>

<p>[<em>service_owner</em>]  The owner of the config file.</p>

<p>Default: redis</p>

<p>[<em>working_dir</em>]  The directory into which sentinel will change to
avoid mount  conflicts.</p>

<p>Default: /tmp</p>

<p>[<em>notification_script</em>]  Path to the notification script</p>

<p>Default: undef</p>

<p>[<em>client_reconfig_script</em>]  Path to the client-reconfig script</p>

<p>Default: undef == Actions:  - Install and configure Redis Sentinel</p>

<p>== Sample Usage:</p>

<p>class { &#39;redis::sentinel&#39;: }</p>

<p>class {&#39;redis::sentinel&#39;:  down_after =&gt; 80000,  log_file =&gt;
&#39;/var/log/redis/sentinel.log&#39;,  }</p>

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>auth_pass</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_auth_pass</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>config_file</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_config_file</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>config_file_orig</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_config_file_orig</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>config_file_mode</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_config_file_mode</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>conf_template</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_conf_template</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>daemonize</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_daemonize</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>down_after</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_down_after</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>failover_timeout</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_failover_timeout</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>init_script</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_init_script</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>init_template</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_init_template</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>log_file</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::log_file</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>master_name</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_master_name</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>redis_host</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::bind</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>redis_port</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::port</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>package_name</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_package_name</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>package_ensure</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_package_ensure</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>parallel_sync</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_parallel_sync</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>pid_file</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_pid_file</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>quorum</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_quorum</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>sentinel_bind</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_bind</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>sentinel_port</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_port</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>service_group</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::service_group</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>service_name</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_service_name</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>service_ensure</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::service_ensure</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>service_user</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::service_user</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>working_dir</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_working_dir</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>notification_script</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_notification_script</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>client_reconfig_script</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::redis::params::sentinel_client_reconfig_script</tt>)</em>
      
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/sentinel.pp', line 162</span>

class redis::sentinel (
  $auth_pass              = $::redis::params::sentinel_auth_pass,
  $config_file            = $::redis::params::sentinel_config_file,
  $config_file_orig       = $::redis::params::sentinel_config_file_orig,
  $config_file_mode       = $::redis::params::sentinel_config_file_mode,
  $conf_template          = $::redis::params::sentinel_conf_template,
  $daemonize              = $::redis::params::sentinel_daemonize,
  $down_after             = $::redis::params::sentinel_down_after,
  $failover_timeout       = $::redis::params::sentinel_failover_timeout,
  $init_script            = $::redis::params::sentinel_init_script,
  $init_template          = $::redis::params::sentinel_init_template,
  $log_file               = $::redis::params::log_file,
  $master_name            = $::redis::params::sentinel_master_name,
  $redis_host             = $::redis::params::bind,
  $redis_port             = $::redis::params::port,
  $package_name           = $::redis::params::sentinel_package_name,
  $package_ensure         = $::redis::params::sentinel_package_ensure,
  $parallel_sync          = $::redis::params::sentinel_parallel_sync,
  $pid_file               = $::redis::params::sentinel_pid_file,
  $quorum                 = $::redis::params::sentinel_quorum,
  $sentinel_bind          = $::redis::params::sentinel_bind,
  $sentinel_port          = $::redis::params::sentinel_port,
  $service_group          = $::redis::params::service_group,
  $service_name           = $::redis::params::sentinel_service_name,
  $service_ensure         = $::redis::params::service_ensure,
  $service_user           = $::redis::params::service_user,
  $working_dir            = $::redis::params::sentinel_working_dir,
  $notification_script    = $::redis::params::sentinel_notification_script,
  $client_reconfig_script = $::redis::params::sentinel_client_reconfig_script,
) inherits redis::params {

  require ::redis

  if $::osfamily == &#39;Debian&#39; {
    # Debian flavour machines have a dedicated redis-sentinel package
    # This is default in Xenial onwards, unstable debian or PPA/other upstream
    # See https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=775414 for context
    if (versioncmp($::operatingsystemmajrelease, &#39;16.04&#39;) &gt;= 0 or $::redis::manage_repo) {
      package { $package_name:
        ensure =&gt; $package_ensure,
      }
    }
  }

  file {
    $config_file_orig:
      ensure  =&gt; present,
      owner   =&gt; $service_user,
      group   =&gt; $service_group,
      mode    =&gt; $config_file_mode,
      content =&gt; template($conf_template),
      require =&gt; Package[$package_name];
  }

  exec {
    &quot;cp -p ${config_file_orig} ${config_file}&quot;:
      path        =&gt; &#39;/usr/bin:/bin&#39;,
      subscribe   =&gt; File[$config_file_orig],
      notify      =&gt; Service[$service_name],
      refreshonly =&gt; true;
  }

  if $init_script {

    file {
      $init_script:
        ensure  =&gt; present,
        owner   =&gt; &#39;root&#39;,
        group   =&gt; &#39;root&#39;,
        mode    =&gt; &#39;0755&#39;,
        content =&gt; template($init_template),
        require =&gt; Package[$package_name];
    }

    exec {
      &#39;/usr/sbin/update-rc.d redis-sentinel defaults&#39;:
        subscribe   =&gt; File[$init_script],
        refreshonly =&gt; true;
    }

  }

  service { $service_name:
    ensure     =&gt; $service_ensure,
    enable     =&gt; $::redis::params::service_enable,
    hasrestart =&gt; $::redis::params::service_hasrestart,
    hasstatus  =&gt; $::redis::params::service_hasstatus,
  }

}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
  Generated on Sat Jul  1 14:41:08 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>